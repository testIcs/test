<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zxkj.dao.ApplyMoneyMapper">

	<insert id="addApplyMoney" parameterType="ApplyMoneyVO">
		insert into
		tbl_apply_money
		(
		applyFlow_no,
		user_id,
		apply_money,
		beginApply_date,
		endApply_date,
		apply_status,
		real_name,
		account,
		paygate_type
		)
		VALUES
		(
		#{applyFlowNo},
		#{userId},
		#{applyMoney},
		now(),
		#{endApplyDate},
		#{applyStatus},
		#{realName},
		#{account},
		#{paygateType}
		)
	</insert>

	<select id="selectApplyStatusNo" parameterType="ApplyMoneyVO" resultType="Integer">
		select 
			count(1)
		from
			tbl_apply_money
		where 
			apply_status=0 
			AND 
			user_id = #{userId}
	</select>
	
	<select id="selectPayFlowStatus" parameterType="ApplyMoneyVO" resultType="Integer">
		SELECT 
			count(1)
		FROM 
			tbl_apply_money tam
			LEFT JOIN tbl_pay_flowrecord tpf ON(tam.applyflow_no = tpf.businessFlow_no)
		WHERE 
			tam.user_id = #{userId}
			AND 
			tpf.pay_status in (0,2)
	</select>

</mapper>